<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0088cc">
    <title>–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/minkoop-rf/KOOP@main/telegram-mini-app-styles.css">
</head>
<body>
    <!-- OVERLAY –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–µ–π -->
    <div class="panel-overlay" id="panelOverlay"></div>
    
    <div class="container">
        <!-- –õ–ï–í–û–ï –ú–ï–ù–Æ -->
        <div class="panel sidebar-menu" id="sidebarMenu">
            <div class="menu-header">
                <div class="menu-title">üè† –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤</div>
                <button class="menu-close-btn" id="menuCloseBtn">‚óÄ</button>
            </div>
            <div class="menu-content" id="menuContent">
                <!-- –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –°–ü–ò–°–û–ö –ß–ê–¢–û–í -->
        <div class="chats-panel" id="chatsPanel">
            <div class="chats-header">
                <button class="header-action-btn" id="burgerBtn">‚ò∞</button>
                <div class="cooperative-info">
                    <div class="cooperative-name" id="cooperativeName">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤</div>
                    <div class="cooperative-stats" id="cooperativeStats">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            <div class="search-section">
                <div class="search-box">
                    <span>üîç</span>
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–∞–π—â–∏–∫–æ–≤..." id="searchInput">
                </div>
                <div class="quick-filters" id="quickFilters">
                    <button class="filter-chip active">–í—Å–µ</button>
                    <button class="filter-chip">üî¥ –î–æ–ª–∂–Ω–∏–∫–∏</button>
                    <button class="filter-chip">üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                </div>
            </div>
            <div class="chats-list" id="chatsList">
                <!-- –ß–∞—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-header-avatar" id="currentAvatar">–ò–ò</div>
                <div style="flex:1">
                    <div class="chat-header-name" id="currentName">–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á</div>
                    <div class="chat-header-status" id="currentStatus">‚óè –ê–∫—Ç–∏–≤–µ–Ω</div>
                </div>
                <button class="header-action-btn" id="menuMoreBtn">‚ãÆ</button>
            </div>
            <div class="messages-container" id="messagesContainer">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="message-input-wrapper">
                <div class="message-input-area">
                    <input type="text" class="message-input" placeholder="–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é..." id="messageInput">
                    <button class="send-button" id="sendButton">‚û§</button>
                </div>
            </div>
        </div>
        
        <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–π—â–∏–∫–µ -->
        <div class="panel sidebar-right" id="sidebarRight">
            <div class="menu-header" style="background:linear-gradient(135deg, #4caf50, #2e7d32)">
                <div class="menu-title">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                <button class="menu-close-btn" id="closeInfoBtn">‚úï</button>
            </div>
            <div class="menu-content" id="memberInfoContent">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –ü–ê–ù–ï–õ–¨ –ö–û–ù–¢–ï–ù–¢–ê –ú–ï–ù–Æ -->
        <div class="panel menu-content-panel" id="menuContentPanel">
            <div class="menu-header" style="background:linear-gradient(135deg, #ff9800, #f57c00)">
                <div class="menu-title" id="menuPanelTitle">–†–∞–∑–¥–µ–ª</div>
                <button class="menu-close-btn" id="closePanelBtn">‚úï</button>
            </div>
            <div class="menu-content" id="menuPanelContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
        
        <!-- –ü–ê–ù–ï–õ–¨ –û–¢–ß–Å–¢–û–í -->
        <div class="panel large-report-panel" id="largeReportPanel">
            <div class="menu-header" style="background:linear-gradient(135deg, #2196f3, #1976d2)">
                <div class="menu-title" id="largeReportTitle">–û—Ç—á—ë—Ç</div>
                <button class="menu-close-btn" id="closeLargeReportBtn">‚úï</button>
            </div>
            <div class="menu-content" id="largeReportContent">
                <!-- –û—Ç—á—ë—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
    
    <!-- –ó–ê–ì–†–£–ó–ö–ê -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script src="https://cdn.jsdelivr.net/gh/minkoop-rf/KOOP@main/yandex-disk-integration.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/minkoop-rf/KOOP@main/app.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/minkoop-rf/KOOP@main/messenger-app-v2.js"></script>
    
    <!-- TELEGRAM MINI APP INIT -->
    <script>
        // ============================================
        // TELEGRAM WEBAPP INITIALIZATION
        // ============================================
        const tg = window.Telegram.WebApp;
        
        // –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
        tg.ready();
        
        // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–≤–µ—Ç–∞
        function applyTelegramTheme() {
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.backgroundColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.textColor || '#000000');
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.hintColor || '#999999');
            document.documentElement.style.setProperty('--tg-theme-link-color', tg.linkColor || '#2481cc');
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.buttonColor || '#2481cc');
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.buttonTextColor || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.secondaryBackgroundColor || '#f0f2f5');
        }
        
        applyTelegramTheme();
        
        // –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
        tg.MainButton.setText('–ù–ê–ß–ê–¢–¨ –†–ê–ë–û–¢–£');
        tg.MainButton.onClick(() => {
            document.getElementById('loadingOverlay').style.display = 'none';
            tg.MainButton.hide();
        });
        tg.MainButton.show();
        
        // ============================================
        // PANEL MANAGER
        // ============================================
        const PanelManager = {
            currentPanel: null,
            overlay: document.getElementById('panelOverlay'),
            
            open(panelId) {
                // –ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–∞–Ω–µ–ª–∏
                this.closeAll();
                
                // –û—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—É—é
                const panel = document.getElementById(panelId);
                if (panel) {
                    panel.classList.add('visible');
                    this.overlay.classList.add('active');
                    this.currentPanel = panelId;
                    
                    // Haptic feedback
                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('light');
                    }
                }
            },
            
            close(panelId) {
                const panel = document.getElementById(panelId);
                if (panel) {
                    panel.classList.remove('visible');
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –±—ã–ª–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–∞–Ω–µ–ª—å, —Å–∫—Ä—ã—Ç—å overlay
                    if (!document.querySelector('.panel.visible')) {
                        this.overlay.classList.remove('active');
                    }
                    
                    this.currentPanel = null;
                }
            },
            
            closeAll() {
                document.querySelectorAll('.panel.visible').forEach(panel => {
                    panel.classList.remove('visible');
                });
                this.overlay.classList.remove('active');
                this.currentPanel = null;
            }
        };
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
        document.getElementById('panelOverlay').addEventListener('click', () => {
            PanelManager.closeAll();
        });
        
        // ============================================
        // SWIPE GESTURES
        // ============================================
        let touchStartX = 0;
        let touchEndX = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        
        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, { passive: true });
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ ‚Üí –∑–∞–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å
            if (diff < -swipeThreshold && PanelManager.currentPanel) {
                PanelManager.closeAll();
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('medium');
                }
            }
        }
        
        // ============================================
        // LOADING
        // ============================================
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // ============================================
        // ERROR HANDLING
        // ============================================
        window.addEventListener('error', e => {
            console.error('–û—à–∏–±–∫–∞:', e.error);
            tg.showAlert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + e.error.message);
        });
        
        // ============================================
        // INIT
        // ============================================
        console.log('üöÄ Telegram Mini App –∑–∞–ø—É—â–µ–Ω');
    </script>
</body>
</html>
