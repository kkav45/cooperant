# Обновленная техническая документация для системы учета пайщиков

## 1. Новые функции системы

### 1.1 Учет паевых взносов в натуральной форме
- Возможность внесения паевых взносов не только деньгами, но и иным имуществом
- Поддержка трех форм оплаты: наличные, безналичные, имущество
- Для имущественных взносов требуется оценка стоимости

### 1.2 Механизм выбытия пайщиков
- Процедура исключения пайщика из кооператива
- Различные причины выбытия: добровольный выход, смерть, исключение, реорганизация
- Автоматический расчет суммы к возврату при выбытии

### 1.3 Возврат паевых взносов
- Возможность возврата паевого взноса при выбытии пайщика
- Возврат может быть осуществлен в денежной или натуральной форме
- Автоматическое формирование бухгалтерских проводок при возврате

### 1.4 Оценка имущества
- Формирование актов оценки имущества, вносимого в качестве паевого взноса
- Различные методы оценки: рыночная стоимость, балансовая стоимость, экспертная оценка
- Возможность указания оценщика и примечаний к оценке

### 1.5 Автоматические бухгалтерские проводки
- Автоматическое формирование проводок при внесении и возврате паевых взносов
- Связывание проводок с конкретными операциями
- Различные проводки для взносов и возвратов

## 2. Обновленная структура данных

### 2.1 Структура паевого взноса
```javascript
{
  id: string,                    // Уникальный идентификатор
  memberId: string,              // Идентификатор пайщика
  type: enum('entrance'|'share'|'voluntary_share'|'membership'|'targeted'|'return_share'), // Тип взноса
  method: enum('cash'|'non_cash'|'property'), // Метод оплаты
  amount: number,                // Сумма (для имущества - после оценки)
  propertyDescription: string,   // Описание имущества (если method='property')
  date: string,                  // Дата операции
  description: string,           // Описание операции
  paid: boolean,                 // Статус оплаты
  documentNumber: string,        // Номер документа
  isReturn: boolean,             // Признак возврата (для возвратов)
  evaluation: object,            // Информация об оценке (для имущественных взносов)
  createdAt: string,             // Дата создания
  updatedAt: string              // Дата обновления
}
```

### 2.2 Структура оценки имущества
```javascript
{
  date: string,                  // Дата оценки
  amount: number,                // Оценочная стоимость
  method: enum('market'|'book'|'expert'|'agreed'), // Метод оценки
  expert: string,                // Оценщик/Эксперт
  notes: string,                 // Примечания к оценке
  createdAt: string              // Дата создания
}
```

### 2.3 Структура бухгалтерской проводки
```javascript
{
  id: string,                    // Уникальный идентификатор
  date: string,                  // Дата проводки
  amount: number,                // Сумма проводки
  debitAccount: string,          // Дебетовый счет
  creditAccount: string,         // Кредитовый счет
  description: string,           // Описание проводки
  relatedPaymentId: string,      // Связь с паевым взносом
  transactionType: enum('incoming'|'return'), // Тип операции
  createdAt: string,             // Дата создания
  updatedAt: string              // Дата обновления
}
```

### 2.4 Структура пайщика (обновленная)
```javascript
{
  id: string,                    // Уникальный идентификатор
  name: string,                  // ФИО пайщика
  status: enum('candidate'|'active'|'suspended'|'excluded'|'withdrawn'), // Статус
  joinDate: string,              // Дата вступления
  withdrawalDate: string,        // Дата выбытия (для выбывших)
  withdrawalReason: string,      // Причина выбытия
  withdrawalNotes: string,       // Примечания к выбытию
  contact: string,               // Контактная информация
  address: string,               // Адрес
  notes: string,                 // Примечания
  createdAt: string,             // Дата создания
  updatedAt: string              // Дата обновления
}
```

## 3. Новые функции интерфейса

### 3.1 Форма добавления паевого взноса
- Выбор формы оплаты (наличные, безналичные, имущество)
- Условное отображение полей в зависимости от формы оплаты
- Поле для описания имущества при оплате имуществом
- Поле для номера документа (акт внесения паевого взноса)

### 3.2 Форма выбытия пайщика
- Выбор причины выбытия
- Указание даты выбытия
- Примечания к выбытию
- Автоматический расчет суммы к возврату

### 3.3 Форма возврата паевого взноса
- Указание суммы к возврату
- Выбор формы возврата (наличные, безналичные, имущество)
- Поле для описания возвращаемого имущества
- Номер документа (акт возврата паевого взноса)

### 3.4 Форма оценки имущества
- Описание имущества (только для чтения)
- Дата оценки
- Оценочная стоимость
- Метод оценки
- Оценщик/Эксперт
- Примечания к оценке

## 4. Бухгалтерские проводки

### 4.1 Проводки при внесении паевого взноса
- Наличные/безналичные: Дт 51 Кт 86
- Имущество: Дт 08 Кт 86

### 4.2 Проводки при возврате паевого взноса
- Возврат деньгами: Дт 86 Кт 51
- Возврат имуществом: Дт 86 Кт 08

### 4.3 Связывание проводок
- Каждая проводка связана с соответствующим паевым взносом
- Признак типа операции (взнос/возврат)
- Отображение связанной информации в таблице проводок

## 5. Обновленные отчеты

### 5.1 Отчет по паевым взносам
- Учет количества и суммы взносов и возвратов отдельно
- Отображение формы оплаты
- Индикация неоцененного имущества
- Статистика по типам операций

### 5.2 Бухгалтерский баланс
- Разделение проводок на поступления и возвраты
- Статистика по типам проводок
- Отображение типа операции в таблице проводок

## 6. Безопасность и целостность данных

### 6.1 Проверки при выбытии пайщика
- Проверка наличия задолженностей
- Запрет выбытия при наличии неоплаченных взносов

### 6.2 Связность данных
- Удаление связанных проводок при удалении взноса
- Обновление проводок при изменении оценки имущества
- Контроль целостности связей между сущностями

## 7. Алгоритмы и бизнес-логика

### 7.1 Расчет суммы к возврату
- Учитываются только оплаченные паевые взносы
- Исключаются вступительные и членские взносы
- Учитываются добровольные взносы

### 7.2 Обработка имущественных взносов
- Имущественный взнос должен быть оценен до использования
- Пока не оценен, отображается как "Не оценено"
- После оценки сумма обновляется в связанной проводке

### 7.3 Обновление статусов
- При выбытии пайщика статус меняется на 'withdrawn'
- При восстановлении членства статус меняется на 'active'
- Недоступные действия скрываются в зависимости от статуса