<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Telegram Mini App Meta -->
    <meta name="theme-color" content="#2481cc">
    <meta name="color-scheme" content="light dark">
    
    <!-- PWA Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Description -->
    <meta name="description" content="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –ø–∞–π—â–∏–∫–æ–≤ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞">
    
    <title>–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    
    <!-- Telegram Web Apps SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ Telegram Mini App -->
    <link rel="stylesheet" href="telegram-mini-app-styles.css">
</head>
<body>
    <div class="container">
        <!-- –õ–µ–≤–æ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <aside class="sidebar-menu" id="sidebarMenu">
            <div class="menu-header">
                <div class="menu-title">‚ò∞ –ú–µ–Ω—é</div>
                <button class="menu-close-btn" id="menuCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é">‚úï</button>
            </div>
            <div class="menu-content" id="menuContent">
                <!-- –°–µ–∫—Ü–∏–∏ –º–µ–Ω—é –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </aside>

        <!-- –ü–æ–¥–º–µ–Ω—é –æ—Ç—á–µ—Ç–æ–≤ -->
        <aside class="reports-submenu" id="reportsSubmenu">
            <div class="submenu-header">
                <button class="submenu-back-btn" id="reportsBackBtn">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
                <div class="submenu-title" id="reportsSubmenuTitle">–û—Ç—á—ë—Ç—ã</div>
                <div style="width: 36px;"></div> <!-- –î–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–∏ -->
            </div>
            <div class="submenu-content" id="reportsSubmenuContent">
                <!-- –°–µ–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </aside>

        <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
        <aside class="chats-panel" id="chatsPanel">
            <div class="chats-header">
                <button class="burger-btn" id="burgerBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">‚ò∞</button>
                <div class="cooperative-info">
                    <div class="cooperative-name" id="cooperativeName">–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ ¬´–ù–∞–∑–≤–∞–Ω–∏–µ¬ª</div>
                    <div class="cooperative-stats" id="cooperativeStats">125 –ø–∞–π—â–∏–∫–æ–≤</div>
                </div>
                <button class="menu-more-btn" id="menuMoreBtn" aria-label="–ï—â—ë">‚ãÆ</button>
            </div>
            
            <div class="search-section">
                <div class="search-box">
                    <span style="margin-right: 8px;">üîç</span>
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–∞–π—â–∏–∫–æ–≤...">
                </div>
                <div class="quick-filters" id="quickFilters">
                    <button class="filter-chip active" data-filter="all">–í—Å–µ</button>
                    <button class="filter-chip" data-filter="active">‚úì –ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                    <button class="filter-chip" data-filter="debt">‚ö† –î–æ–ª–∂–Ω–∏–∫–∏</button>
                    <button class="filter-chip" data-filter="pending">üìù –ù–æ–≤—ã–µ</button>
                </div>
            </div>
            
            <div class="chats-list" id="chatsList">
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </aside>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å (–æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç) -->
        <main class="main-chat" id="mainChat">
            <div class="chat-header">
                <div class="chat-header-left">
                    <div class="chat-header-avatar" id="currentAvatar">–ò–ê</div>
                    <div>
                        <div class="chat-header-name" id="currentName">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–π—â–∏–∫–∞</div>
                        <div class="chat-header-status" id="currentStatus">–û–Ω–ª–∞–π–Ω</div>
                    </div>
                </div>
                <div class="chat-header-actions">
                    <button class="header-action-btn" id="callBtn" aria-label="–ü–æ–∑–≤–æ–Ω–∏—Ç—å">üìû</button>
                    <button class="header-action-btn" id="infoBtn" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">‚ÑπÔ∏è</button>
                </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <div class="message-input-wrapper">
                <div class="message-input-area">
                    <button class="attach-btn" id="attachBtn" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å">üìé</button>
                    <input type="text" class="message-input" id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                    <button class="voice-btn" id="voiceBtn" aria-label="–ì–æ–ª–æ—Å–æ–≤–æ–µ">üé§</button>
                    <button class="send-button" id="sendButton">‚û§</button>
                </div>
            </div>
        </main>

        <!-- –ë–æ–ª—å—à–∞—è –ø—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–æ—Ç—á–µ—Ç—ã) -->
        <aside class="large-report-panel" id="largeReportPanel">
            <div class="large-report-header">
                <div class="large-report-title" id="largeReportTitle">–û—Ç—á—ë—Ç</div>
                <button class="close-large-report-btn" id="closeLargeReportBtn">‚úï</button>
            </div>
            <div class="large-report-content" id="largeReportContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á—ë—Ç–∞ -->
            </div>
        </aside>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–∏–Ω—Ñ–æ –æ –ø–∞–π—â–∏–∫–µ) -->
        <aside class="sidebar-right" id="sidebarRight">
            <div class="member-info-header">
                <div class="large-report-title">–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                <button class="close-info-btn" id="closeInfoBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
            </div>
            <div class="member-info-content" id="memberInfoContent">
                <!-- –î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
            </div>
        </aside>
    </div>

    <!-- FAB –∫–Ω–æ–ø–∫–∞ -->
    <div class="fab-container hidden" id="fabContainer">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item">
                <button class="fab-item-btn" id="fabNewOperation" style="background: linear-gradient(135deg, #4caf50, #43a047);">üí∞</button>
                <div class="fab-item-label">–û–ø–µ—Ä–∞—Ü–∏—è</div>
            </div>
            <div class="fab-item">
                <button class="fab-item-btn" id="fabNewMessage" style="background: linear-gradient(135deg, #2196f3, #1e88e5);">‚úâÔ∏è</button>
                <div class="fab-item-label">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
            </div>
            <div class="fab-item">
                <button class="fab-item-btn" id="fabScanQR" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">üì∑</button>
                <div class="fab-item-label">QR –∫–æ–¥</div>
            </div>
        </div>
        <button class="fab-main" id="fabMain">+</button>
    </div>

    <!-- Telegram Mini App Integration -->
    <script src="telegram-mini-app.js"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        // ========================================
        // –î–ê–ù–ù–´–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ========================================
        
        const membersData = [
            { 
                id: 1, 
                name: "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á", 
                avatar: "–ò–ê", 
                color: "linear-gradient(135deg,#ff6b6b,#ee5a5a)", 
                status: "debt", 
                statusText: "–î–æ–ª–∂–Ω–∏–∫", 
                balance: -2000, 
                phone: "+7 (999) 123-45-67", 
                email: "ivanov@example.com", 
                lastTransaction: "–ü—Ä–æ—Å—Ä–æ—á–µ–Ω —á–ª–µ–Ω—Å–∫–∏–π –≤–∑–Ω–æ—Å (2 –º–µ—Å)", 
                lastTime: "10:30",
                operations: [
                    { id: 1, type: "–í–Ω–µ—Å–µ–Ω–∏–µ –ø–∞—è", amount: 5000, date: "2024-01-15", description: "–ï–∂–µ–≥–æ–¥–Ω—ã–π –ø–∞–µ–≤–æ–π –≤–∑–Ω–æ—Å", status: "paid" },
                    { id: 2, type: "–ß–ª–µ–Ω—Å–∫–∏–π –≤–∑–Ω–æ—Å", amount: 1000, date: "2024-02-01", description: "–ß–ª–µ–Ω—Å–∫–∏–π –≤–∑–Ω–æ—Å –∑–∞ —Ñ–µ–≤—Ä–∞–ª—å", status: "overdue" }
                ]
            },
            { 
                id: 2, 
                name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞", 
                avatar: "–ü–ú", 
                color: "linear-gradient(135deg,#51cf66,#40c057)", 
                status: "active", 
                statusText: "–ê–∫—Ç–∏–≤–µ–Ω", 
                balance: 25000, 
                phone: "+7 (999) 234-56-78", 
                email: "petrova@example.com", 
                lastTransaction: "–í–Ω–µ—Å—ë–Ω –ø–∞–µ–≤–æ–π –≤–∑–Ω–æ—Å 10 000 ‚ÇΩ", 
                lastTime: "–í—á–µ—Ä–∞",
                operations: [
                    { id: 4, type: "–í–Ω–µ—Å–µ–Ω–∏–µ –ø–∞—è", amount: 10000, date: "2024-01-14", description: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–µ–≤–æ–π –≤–∑–Ω–æ—Å", status: "paid" },
                    { id: 5, type: "–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", amount: 5000, date: "2023-12-10", description: "–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", status: "paid" }
                ]
            },
            { 
                id: 3, 
                name: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π –ü–µ—Ç—Ä–æ–≤–∏—á", 
                avatar: "–°–î", 
                color: "linear-gradient(135deg,#fcc419,#fab005)", 
                status: "pending", 
                statusText: "–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏", 
                balance: 5000, 
                phone: "+7 (999) 345-67-89", 
                email: "sidorov@example.com", 
                lastTransaction: "–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –ø–æ–¥–∞–Ω–æ", 
                lastTime: "–ü—Ç",
                operations: [
                    { id: 7, type: "–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", amount: 5000, date: "2024-01-13", description: "–í—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", status: "pending" }
                ]
            }
        ];

        let currentMember = null;
        let currentMessages = [];
        let fabExpanded = false;

        // ========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        // ========================================
        
        document.addEventListener('DOMContentLoaded', async () => {
            // –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram
            await window.TelegramMiniApp.ready();
            
            console.log('App initialized with Telegram:', window.TelegramMiniApp.ready());
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
            const userData = window.TelegramMiniApp.getUserData();
            if (userData) {
                console.log('User data from Telegram:', userData);
                // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å userData.firstName, userData.username –∏ —Ç.–¥.
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            initApp();
        });

        function initApp() {
            renderChats();
            renderMenu();
            if (membersData.length > 0) {
                selectMember(membersData[0]);
            }
            setupEventListeners();
            setupFabButton();
            setupFilters();
            setupSearch();
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
            applyHapticFeedbackToButtons();
        }

        // ========================================
        // –†–ï–ù–î–ï–†–ò–ù–ì –ß–ê–¢–û–í
        // ========================================
        
        function renderChats(filter = 'all') {
            const chatsList = document.getElementById('chatsList');
            
            const filteredData = filter === 'all' 
                ? membersData 
                : membersData.filter(m => m.status === filter);
            
            chatsList.innerHTML = filteredData.map(m => {
                const balanceClass = m.balance >= 0 ? 'positive' : 'negative';
                const balanceText = m.balance >= 0 ? `${m.balance.toLocaleString()} ‚ÇΩ` : `‚àí${Math.abs(m.balance).toLocaleString()} ‚ÇΩ`;
                const icon = m.status === 'debt' ? '‚ö†' : m.status === 'pending' ? 'üìù' : '‚úì';
                
                return `<div class="chat-item" data-id="${m.id}">
                    <div class="avatar" style="background:${m.color}">${m.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-top">
                            <span class="chat-name">${m.name}</span>
                            <span class="chat-time">${m.lastTime}</span>
                        </div>
                        <div class="chat-middle">
                            <span class="status ${m.status}">${m.statusText}</span>
                            <span class="balance ${balanceClass}">${balanceText}</span>
                        </div>
                        <div class="last-message">
                            <span class="icon">${icon}</span> ${m.lastTransaction}
                        </div>
                    </div>
                </div>`;
            }).join('');

            chatsList.querySelectorAll('.chat-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = parseInt(item.dataset.id);
                    const member = membersData.find(m => m.id === id);
                    if (member) {
                        window.TelegramMiniApp.hapticFeedback('light');
                        selectMember(member);
                    }
                });
            });
        }

        // ========================================
        // –í–´–ë–û–† –ü–ê–ô–©–ò–ö–ê
        // ========================================
        
        function selectMember(member) {
            currentMember = member;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            document.getElementById('currentName').textContent = member.name;
            document.getElementById('currentAvatar').textContent = member.avatar;
            document.getElementById('currentStatus').textContent = member.statusText;
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —á–∞—Ç–æ–≤
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É —á–∞—Ç—É
            const activeItem = document.querySelector(`.chat-item[data-id="${member.id}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            renderMessages(member.operations);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å
            document.getElementById('sidebarRight').classList.remove('visible');
        }

        // ========================================
        // –†–ï–ù–î–ï–†–ò–ù–ì –°–û–û–ë–©–ï–ù–ò–ô
        // ========================================
        
        function renderMessages(messages) {
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
            currentMessages = [...messages];

            messages.forEach(msg => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message received';
                messageElement.dataset.id = msg.id;

                const formattedAmount = msg.amount ? `${msg.amount.toLocaleString()} —Ä—É–±.` : '';

                messageElement.innerHTML = `
                    <div class="message-type">${msg.type}</div>
                    <div class="message-content">${formattedAmount}</div>
                    <div class="message-time">${msg.date}</div>
                `;

                messageElement.addEventListener('click', () => {
                    window.TelegramMiniApp.hapticFeedback('light');
                    showMessageDetails(msg);
                });
                
                messagesContainer.appendChild(messageElement);
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // ========================================
        // –î–ï–¢–ê–õ–ò –û–ü–ï–†–ê–¶–ò–ò
        // ========================================
        
        function showMessageDetails(operation) {
            const content = document.getElementById('memberInfoContent');
            content.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
                    <div class="detail-value highlight">${operation.type}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–°—É–º–º–∞</div>
                    <div class="detail-value highlight">${operation.amount ? operation.amount.toLocaleString() + ' —Ä—É–±.' : '‚Äî'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–î–∞—Ç–∞</div>
                    <div class="detail-value">${operation.date}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                    <div class="detail-value">${operation.description || '‚Äî'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–°—Ç–∞—Ç—É—Å</div>
                    <div class="detail-value">${operation.status || '‚Äî'}</div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="action-btn secondary">–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å</button>
                    <button class="action-btn danger">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;
            
            document.getElementById('sidebarRight').classList.add('visible');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ BackButton
            window.TelegramMiniApp.addBackHandler(() => {
                document.getElementById('sidebarRight').classList.remove('visible');
                window.TelegramMiniApp.removeBackHandler();
            });
        }

        // ========================================
        // –ú–ï–ù–Æ
        // ========================================
        
        function renderMenu() {
            const menuContent = document.getElementById('menuContent');
            const menuSections = [
                {
                    title: '–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã',
                    items: [
                        { icon: 'üè†', name: '–ì–ª–∞–≤–Ω–∞—è', subtitle: '–û–±–∑–æ—Ä –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞' },
                        { icon: 'üë•', name: '–ü–∞–π—â–∏–∫–∏', subtitle: '–†–µ–µ—Å—Ç—Ä —á–ª–µ–Ω–æ–≤' },
                        { icon: 'üí≥', name: '–í–∑–Ω–æ—Å—ã', subtitle: '–ü–ª–∞—Ç–µ–∂–∏ –∏ –≤–∑–Ω–æ—Å—ã' },
                        { icon: 'üìò', name: '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è', subtitle: '–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã' }
                    ]
                },
                {
                    title: '–î–æ–∫—É–º–µ–Ω—Ç—ã',
                    items: [
                        { icon: 'üìÅ', name: '–î–æ–∫—É–º–µ–Ω—Ç—ã', subtitle: '–í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã' },
                        { icon: 'üìù', name: '–ó–∞—è–≤–ª–µ–Ω–∏—è', subtitle: '–ó–∞—è–≤–ª–µ–Ω–∏—è –ø–∞–π—â–∏–∫–æ–≤' },
                        { icon: 'ü§ù', name: '–ó–∞—Å–µ–¥–∞–Ω–∏—è', subtitle: '–ü—Ä–æ—Ç–æ–∫–æ–ª—ã —Å–æ–±—Ä–∞–Ω–∏–π' }
                    ]
                },
                {
                    title: '–û—Ç—á—ë—Ç—ã',
                    items: [
                        { icon: 'üìä', name: '–û—Ç—á—ë—Ç—ã', subtitle: '–í—Å–µ –æ—Ç—á—ë—Ç—ã' },
                        { icon: 'üìà', name: '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞', subtitle: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏' }
                    ]
                }
            ];
            
            menuContent.innerHTML = menuSections.map(section => `
                <div class="menu-section">
                    <div class="menu-section-title">${section.title}</div>
                    ${section.items.map(item => `
                        <div class="menu-item" data-item="${item.name}">
                            <div class="menu-item-icon">${item.icon}</div>
                            <div class="menu-item-info">
                                <div class="menu-item-name">${item.name}</div>
                                <div class="menu-item-subtitle">${item.subtitle}</div>
                            </div>
                            <div class="menu-arrow">‚Ä∫</div>
                        </div>
                    `).join('')}
                </div>
            `).join('');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
            menuContent.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    window.TelegramMiniApp.hapticFeedback('light');
                    const itemName = item.dataset.item;
                    
                    if (itemName === '–û—Ç—á—ë—Ç—ã' || itemName === '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞') {
                        openReportsSubmenu(itemName);
                    } else {
                        window.TelegramMiniApp.showAlert(`–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª "${itemName}" (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)`);
                    }
                });
            });
        }

        // ========================================
        // –ü–û–î–ú–ï–ù–Æ –û–¢–ß–Å–¢–û–í
        // ========================================
        
        function openReportsSubmenu(title) {
            document.getElementById('reportsSubmenuTitle').textContent = title;
            const content = document.getElementById('reportsSubmenuContent');
            
            const reports = [
                { icon: 'üìä', title: '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–π –±–∞–ª–∞–Ω—Å', desc: '–§–æ—Ä–º–∞ ‚Ññ1' },
                { icon: 'üìà', title: '–û—Ç—á—ë—Ç –æ —Ñ–∏–Ω. —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö', desc: '–§–æ—Ä–º–∞ ‚Ññ2' },
                { icon: 'üìã', title: '–û—Ç—á—ë—Ç –ø–æ –ø–∞–π—â–∏–∫–∞–º', desc: '–†–µ–µ—Å—Ç—Ä —á–ª–µ–Ω–æ–≤' },
                { icon: 'üí≥', title: '–û—Ç—á—ë—Ç –ø–æ –≤–∑–Ω–æ—Å–∞–º', desc: '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è' }
            ];
            
            content.innerHTML = `
                <div class="submenu-section">
                    ${reports.map(report => `
                        <div class="report-card">
                            <div class="report-card-icon">${report.icon}</div>
                            <div class="report-card-info">
                                <div class="report-card-title">${report.title}</div>
                                <div class="report-card-desc">${report.desc}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('reportsSubmenu').classList.add('visible');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ BackButton
            window.TelegramMiniApp.addBackHandler(() => {
                document.getElementById('reportsSubmenu').classList.remove('visible');
                window.TelegramMiniApp.removeBackHandler();
            });
        }

        // ========================================
        // FAB –ö–ù–û–ü–ö–ê
        // ========================================
        
        function setupFabButton() {
            const fabMain = document.getElementById('fabMain');
            const fabMenu = document.getElementById('fabMenu');
            const fabContainer = document.getElementById('fabContainer');
            
            fabMain.addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('selection');
                fabExpanded = !fabExpanded;
                
                if (fabExpanded) {
                    fabMenu.classList.add('expanded');
                    fabMain.classList.add('close');
                    fabContainer.classList.remove('hidden');
                } else {
                    fabMenu.classList.remove('expanded');
                    fabMain.classList.remove('close');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ FAB
            document.getElementById('fabNewOperation').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('success');
                fabExpanded = false;
                fabMenu.classList.remove('expanded');
                fabMain.classList.remove('close');
                window.TelegramMiniApp.showAlert('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
            
            document.getElementById('fabNewMessage').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('success');
                fabExpanded = false;
                fabMenu.classList.remove('expanded');
                fabMain.classList.remove('close');
                window.TelegramMiniApp.showAlert('–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
            
            document.getElementById('fabScanQR').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('success');
                fabExpanded = false;
                fabMenu.classList.remove('expanded');
                fabMain.classList.remove('close');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∫–∞–Ω–µ—Ä QR Telegram
                if (window.TelegramMiniApp.getTelegram()) {
                    window.TelegramMiniApp.getTelegram().showPopup({
                        title: '–°–∫–∞–Ω–µ—Ä QR',
                        message: '–§—É–Ω–∫—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è QR –∫–æ–¥–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ Telegram.WebApp.scanQR()',
                        buttons: [{type: 'ok'}]
                    });
                } else {
                    window.TelegramMiniApp.showAlert('–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç—Å—è Telegram)');
                }
            });
        }

        // ========================================
        // –§–ò–õ–¨–†–´
        // ========================================
        
        function setupFilters() {
            const filterButtons = document.querySelectorAll('.filter-chip');
            
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    window.TelegramMiniApp.hapticFeedback('selection');
                    
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const filter = btn.dataset.filter;
                    renderChats(filter);
                });
            });
        }

        // ========================================
        // –ü–û–ò–°–ö
        // ========================================
        
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const chatItems = document.querySelectorAll('.chat-item');
                
                chatItems.forEach(item => {
                    const name = item.querySelector('.chat-name').textContent.toLowerCase();
                    const isVisible = name.includes(searchTerm);
                    item.style.display = isVisible ? 'flex' : 'none';
                });
            });
        }

        // ========================================
        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô
        // ========================================
        
        function setupEventListeners() {
            // –ë—É—Ä–≥–µ—Ä –º–µ–Ω—é
            document.getElementById('burgerBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                document.getElementById('sidebarMenu').classList.add('visible');
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é
            document.getElementById('menuCloseBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                document.getElementById('sidebarMenu').classList.remove('visible');
            });
            
            // –ù–∞–∑–∞–¥ –∫ –æ—Ç—á—ë—Ç–∞–º
            document.getElementById('reportsBackBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                document.getElementById('reportsSubmenu').classList.remove('visible');
                window.TelegramMiniApp.removeBackHandler();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –±–æ–ª—å—à–æ–π –ø–∞–Ω–µ–ª–∏ –æ—Ç—á—ë—Ç–æ–≤
            document.getElementById('closeLargeReportBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                document.getElementById('largeReportPanel').classList.remove('visible');
                window.TelegramMiniApp.removeBackHandler();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
            document.getElementById('closeInfoBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                document.getElementById('sidebarRight').classList.remove('visible');
                window.TelegramMiniApp.removeBackHandler();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            document.getElementById('sendButton').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // –ö–Ω–æ–ø–∫–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            document.getElementById('callBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                window.TelegramMiniApp.showAlert('–ó–≤–æ–Ω–æ–∫ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
            
            document.getElementById('infoBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                if (currentMember) {
                    window.TelegramMiniApp.showAlert(`${currentMember.name}\n${currentMember.phone}\n${currentMember.email}`);
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏ –≤–≤–æ–¥–∞
            document.getElementById('attachBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                window.TelegramMiniApp.showAlert('–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
            
            document.getElementById('voiceBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                window.TelegramMiniApp.showAlert('–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–ï—â—ë"
            document.getElementById('menuMoreBtn').addEventListener('click', () => {
                window.TelegramMiniApp.hapticFeedback('light');
                window.TelegramMiniApp.showPopup({
                    title: '–î–µ–π—Å—Ç–≤–∏—è',
                    message: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:',
                    buttons: [
                        {id: 'settings', type: 'default', text: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'},
                        {id: 'help', type: 'default', text: '–ü–æ–º–æ—â—å'},
                        {id: 'cancel', type: 'destructive', text: '–û—Ç–º–µ–Ω–∞'}
                    ]
                }, (buttonId) => {
                    console.log('Selected button:', buttonId);
                });
            });
        }

        // ========================================
        // –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø
        // ========================================
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentMember) return;
            
            window.TelegramMiniApp.hapticFeedback('success');
            
            // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const newMessage = {
                id: Date.now(),
                type: "–°–æ–æ–±—â–µ–Ω–∏–µ",
                amount: 0,
                date: new Date().toISOString().split('T')[0],
                description: text
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º
            currentMember.operations.push(newMessage);
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const messagesContainer = document.getElementById('messagesContainer');
            const messageElement = document.createElement('div');
            messageElement.className = 'message sent';
            messageElement.dataset.id = newMessage.id;
            
            messageElement.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-time">${formatTime(new Date())}</div>
            `;
            
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
            input.value = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            updateLastMessage(currentMember.id, text);
        }

        function formatTime(date) {
            return date.getHours().toString().padStart(2, '0') + ':' + 
                   date.getMinutes().toString().padStart(2, '0');
        }

        function updateLastMessage(memberId, message) {
            const chatItem = document.querySelector(`.chat-item[data-id="${memberId}"]`);
            if (chatItem) {
                const lastMessageEl = chatItem.querySelector('.last-message');
                lastMessageEl.innerHTML = `<span class="icon">‚úì</span> ${message}`;
                
                const timeEl = chatItem.querySelector('.chat-time');
                timeEl.textContent = formatTime(new Date());
            }
        }
    </script>
</body>
</html>
