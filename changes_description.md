# Описание изменений в системе для работы с File System API

## 1. Обновления в app.js

### 1.1 Добавлены новые переменные
- `coopDirectoryHandle` - переменная для хранения дескриптора директории C:\КООПЕРАНТ

### 1.2 Добавлена функция инициализации File System API
- `initializeFileSystemAccess()` - проверяет поддержку File System API и инициализирует доступ

### 1.3 Добавлены функции для работы с директорией документов
- `selectCooperativeDirectory()` - позволяет пользователю выбрать папку C:\КООПЕРАНТ
- `createDocumentDirectories()` - создает поддиректории для разных типов документов
- `setupDocumentStorage()` - функция для настройки хранения документов

### 1.4 Модифицирована функция сохранения документа
- `saveDocument()` - теперь использует File System API для сохранения файлов в папке C:\КООПЕРАНТ
- Файлы сохраняются в соответствующих подпапках в зависимости от типа документа
- Создаются метаданные документа в системе

### 1.5 Добавлены функции для работы с файлами документов
- `openDocumentFile()` - открывает файл документа во внешней программе
- `downloadDocument()` - скачивает файл документа
- Модифицирована `deleteDocument()` - теперь удаляет не только запись из системы, но и физический файл

### 1.6 Модифицирована функция просмотра документа
- `viewDocument()` - теперь показывает дополнительные действия для файлов (открытие, скачивание)

## 2. Обновления в index.html

### 2.1 Добавлена кнопка настройки хранения
- В разделе "Документы" добавлена кнопка "Настроить хранение"
- Позволяет пользователю выбрать папку C:\КООПЕРАНТ для хранения документов

## 3. Новый функционал

### 3.1 Структура папок
Система автоматически создает следующую структуру в папке C:\КООПЕРАНТ:
- Contracts (договоры)
- Reports (отчеты)
- Payments (платежные документы)
- Other (прочие документы)

### 3.2 Типы документов
Система поддерживает следующие типы документов:
- contract (договор)
- report (отчет)
- payment (платежный документ)
- other (прочее)

### 3.3 Безопасность
- Файлы сохраняются только в выбранной пользователем папке
- Система не имеет доступа к другим частям файловой системы
- Все операции требуют явного разрешения пользователя

## 4. Совместимость

### 4.1 Поддерживаемые браузеры
- Google Chrome 86+
- Microsoft Edge 86+
- Opera 72+
- Для других браузеров функциональность ограничена

### 4.2 Резервный механизм
- При отсутствии поддержки File System API система сохраняет только метаданные
- Файлы не сохраняются физически, только информация о них

## 5. Пользовательский опыт

### 5.1 Улучшения
- Возможность хранения документов в указанной папке
- Прямой доступ к файлам документов
- Организация документов по типам
- Удаление файлов вместе с записями в системе

### 5.2 Рабочий процесс
1. Пользователь выбирает папку C:\КООПЕРАНТ для хранения документов
2. Система создает подпапки для разных типов документов
3. При загрузке документа файл сохраняется в соответствующей подпапке
4. Метаданные документа сохраняются в системе
5. Пользователь может открывать, скачивать и удалять документы

## 6. Технические детали

### 6.1 File System Access API
Система использует современный File System Access API:
- showDirectoryPicker() - для выбора директории
- getFileHandle() - для получения дескриптора файла
- createWritable() - для записи файлов
- removeEntry() - для удаления файлов

### 6.2 Обработка ошибок
- Все операции с файлами обернуты в try-catch
- Пользователь получает понятные сообщения об ошибках
- При ошибках физического удаления файл остается в системе как запись

### 6.3 Совместимость с предыдущими версиями
- Все существующие функции сохранены
- Новый функционал не влияет на работу других модулей
- Метаданные документов сохраняются в том же формате

## 7. Документация

### 7.1 Созданные файлы документации
- document_storage_manual.md - инструкция по использованию
- filesystem_setup.md - технические детали настройки

### 7.2 Обновленные файлы
- user_manual.md - обновлена информация о работе с документами
- readme.md - добавлена информация о новом функционале

## 8. Тестирование

### 8.1 Проверенные сценарии
- Выбор папки C:\КООПЕРАНТ
- Создание поддиректорий
- Сохранение файлов разных типов
- Открытие файлов
- Скачивание файлов
- Удаление файлов
- Работа в браузерах без поддержки File System API

### 8.2 Проверка безопасности
- Ограничение доступа к файловой системе
- Проверка прав доступа
- Обработка ошибок безопасности