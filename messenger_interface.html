<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    
    <!-- Telegram Web Apps SDK (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è -->
    <script src="yandex-disk-integration-v2.js?v=20260218"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f2f5;
        }

        .container {
            display: flex;
            height: 100%;
            position: relative;
        }

        /* –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar-left {
            width: 30%;
            max-width: 350px;
            min-width: 280px;
            background-color: #ffffff;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 10;
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .sidebar-left.hidden {
            transform: translateX(-100%);
        }

        .app-header {
            padding: 15px;
            background-color: #0088cc;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .app-title {
            font-size: 18px;
            font-weight: bold;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .search-container {
            padding: 10px;
            background-color: #f0f2f5;
        }

        .search-box {
            width: 100%;
            padding: 10px;
            border-radius: 20px;
            border: 1px solid #e0e0e0;
            outline: none;
        }

        /* –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –∫–Ω–æ–ø–∫–∞ */
        .yandex-disk-section {
            padding: 10px 15px;
            background: linear-gradient(135deg, #fc0 0%, #f9a800 100%);
            border-bottom: 1px solid #e0e0e0;
        }

        .yandex-disk-status {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            gap: 10px;
        }

        .yandex-disk-status:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(252, 0, 0, 0.15);
        }

        .yandex-disk-status:active {
            transform: translateY(0);
        }

        .yandex-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .yandex-text {
            flex: 1;
            font-size: 14px;
            font-weight: 600;
            color: #000;
        }

        .yandex-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
            flex-shrink: 0;
        }

        .yandex-indicator.disconnected {
            background: #f44336;
        }

        .yandex-indicator.syncing {
            background: #ff9800;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }


        .chats-list {
            flex: 1;
            overflow-y: auto;
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f2f5;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .chat-item:hover {
            background-color: #f5f7fa;
        }

        .chat-item.active {
            background-color: #e9ecef;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #0088cc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .chat-info {
            flex: 1;
            overflow: hidden;
        }

        .chat-name {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .last-message {
            font-size: 14px;
            color: #666;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 12px;
            color: #999;
            align-self: flex-start;
            margin-top: 5px;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #f0f2f5;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgdmlld0JveD0iMCAwIDYwIDYwIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNlNWU1ZTUiIGZpbGwtb3BhY2l0eT0iLjIiPjxwYXRoIGQ9Ik0zMCA1QzE2LjE5MyA1IDUgMTYuMTkzIDUgMzBzMTEuMTkzIDI1IDI1IDI1IDI1LTExLjE5MyAyNS0yNS0xMS4xOTMtMjUtMjUtMjV6bTAgNDZjLTExLjA0NiAwLTIwLTguOTU0LTIwLTIwczguOTU0LTIwIDIwLTIwIDIwIDguOTU0IDIwIDIwLTguOTU0IDIwLTIwIDIweiIvPjwvZz48L2c+PC9zdmc+');
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .chat-header {
            padding: 15px;
            background-color: #ffffff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }

        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #0088cc;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }

        .chat-header-name {
            font-weight: bold;
            font-size: 16px;
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .message {
            max-width: 70%;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .received {
            background-color: #ffffff;
            align-self: flex-start;
            border-top-left-radius: 0;
        }

        .sent {
            background-color: #d9fdd3;
            align-self: flex-end;
            border-top-right-radius: 0;
        }

        .message-time {
            font-size: 11px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }

        .message-input-area {
            padding: 15px;
            background-color: #ffffff;
            border-top: 1px solid #e0e0e0;
            display: flex;
        }

        .message-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
        }

        .send-button {
            background-color: #0088cc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            background-color: #0077b3;
        }

        /* –ü—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar-right {
            width: 30%;
            max-width: 350px;
            min-width: 280px;
            background-color: #ffffff;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            z-index: 10;
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            transform: translateX(100%);
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .sidebar-right.visible {
            transform: translateX(0);
        }

        .details-header {
            padding: 15px;
            background-color: #0088cc;
            color: white;
            font-weight: bold;
        }

        .details-content {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—É —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .detail-item {
            margin-bottom: 15px;
        }

        .detail-label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .detail-value {
            padding: 8px;
            background-color: #f5f7fa;
            border-radius: 5px;
        }

        .edit-button {
            background-color: #0088cc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
        @media (max-width: 768px) {
            .sidebar-left {
                position: absolute;
                left: 0;
                top: 0;
                height: 100%;
                z-index: 20;
            }

            .sidebar-right {
                position: absolute;
                right: 0;
                top: 0;
                height: 100%;
            }

            .container {
                flex-direction: column;
            }

            .sidebar-left, .main-chat, .sidebar-right {
                width: 100%;
                max-width: 100%;
                height: auto;
                min-height: 0;
            }

            .sidebar-left {
                height: 40%;
                flex: none;
            }

            .main-chat {
                height: 50%;
                flex: 1;
                min-height: 0;
            }

            .sidebar-right {
                height: 100%;
                transform: translateX(100%);
            }

            .sidebar-right.visible {
                transform: translateX(0);
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –õ–µ–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar-left" id="sidebarLeft">
            <div class="app-header">
                <div class="app-title">–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</div>
                <button class="menu-btn" id="menuBtn">‚ò∞</button>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ -->
            <div class="yandex-disk-section" id="yandexDiskSection">
                <div class="yandex-disk-status" id="yandexDiskStatus" onclick="handleYandexDiskClick()">
                    <span class="yandex-icon">‚òÅÔ∏è</span>
                    <span class="yandex-text" id="yandexDiskText">–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫</span>
                    <span class="yandex-indicator" id="yandexIndicator"></span>
                </div>
            </div>

            <div class="search-container">
                <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–∞–π—â–∏–∫–æ–≤..." id="searchInput">
            </div>

            <div class="chats-list" id="chatsList">
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="main-chat" id="mainChat">
            <div class="chat-header" id="chatHeader">
                <div class="chat-header-avatar" id="currentAvatar">–ê–ò</div>
                <div class="chat-header-name" id="currentName">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–π—â–∏–∫–∞</div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <div class="message-input-area">
                <input type="text" class="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." id="messageInput">
                <button class="send-button" id="sendButton">‚û§</button>
            </div>
        </div>
        
        <!-- –ü—Ä–∞–≤–∞—è –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar-right" id="sidebarRight">
            <div class="details-header">–î–µ—Ç–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
            <div class="details-content" id="detailsContent">
                <div class="detail-item">
                    <div class="detail-label">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏:</div>
                    <div class="detail-value" id="operationType">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–°—É–º–º–∞:</div>
                    <div class="detail-value" id="operationAmount">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–î–∞—Ç–∞:</div>
                    <div class="detail-value" id="operationDate">-</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">–û–ø–∏—Å–∞–Ω–∏–µ:</div>
                    <div class="detail-value" id="operationDescription">-</div>
                </div>
                <button class="edit-button" id="editOperationBtn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ—Ç —Å–≤—è–∑–∏ —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º)
        let members = [
            {
                id: 1,
                name: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π",
                avatar: "–ò–ê",
                lastMessage: "–í–Ω–µ—Å –ø–∞–π 5000 —Ä—É–±.",
                lastTime: "10:30",
                operations: [
                    { id: 1, type: "–í–Ω–µ—Å–µ–Ω–∏–µ –ø–∞—è", amount: 5000, date: "2023-05-15", description: "–ï–∂–µ–≥–æ–¥–Ω—ã–π –≤–∑–Ω–æ—Å" },
                    { id: 2, type: "–í—ã–ø–ª–∞—Ç–∞ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤", amount: 2500, date: "2023-04-20", description: "–î–∏–≤–∏–¥–µ–Ω–¥—ã –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª" }
                ]
            },
            {
                id: 2,
                name: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è",
                avatar: "–ü–ú",
                lastMessage: "–ó–∞–ø—Ä–æ—Å–∏–ª–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—á–µ—Ç–µ",
                lastTime: "09:45",
                operations: [
                    { id: 3, type: "–ó–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", amount: 0, date: "2023-05-14", description: "–ó–∞–ø—Ä–æ—Å –≤—ã–ø–∏—Å–∫–∏ –ø–æ —Å—á–µ—Ç—É" },
                    { id: 4, type: "–í–Ω–µ—Å–µ–Ω–∏–µ –ø–∞—è", amount: 3000, date: "2023-03-10", description: "–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å" }
                ]
            },
            {
                id: 3,
                name: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π",
                avatar: "–°–î",
                lastMessage: "–ü–æ–ª—É—á–∏–ª –æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ –∑–∞–π–º",
                lastTime: "–í—á–µ—Ä–∞",
                operations: [
                    { id: 5, type: "–û–¥–æ–±—Ä–µ–Ω–Ω—ã–π –∑–∞–π–º", amount: 50000, date: "2023-05-13", description: "–ó–∞–π–º –Ω–∞ —Ä–∞–∑–≤–∏—Ç–∏–µ –±–∏–∑–Ω–µ—Å–∞" },
                    { id: 6, type: "–ü–æ–≥–∞—à–µ–Ω–∏–µ –∑–∞–π–º–∞", amount: 10000, date: "2023-04-25", description: "–ß–∞—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–ª–≥–∞" }
                ]
            },
            {
                id: 4,
                name: "–ö–æ–∑–ª–æ–≤–∞ –ï–ª–µ–Ω–∞",
                avatar: "–ö–ï",
                lastMessage: "–û–±–Ω–æ–≤–∏–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã",
                lastTime: "–ü—Ç",
                operations: [
                    { id: 7, type: "–í–Ω–µ—Å–µ–Ω–∏–µ –ø–∞—è", amount: 7000, date: "2023-05-12", description: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å" },
                    { id: 8, type: "–í—ã–ø–ª–∞—Ç–∞ –¥–∏–≤–∏–¥–µ–Ω–¥–æ–≤", amount: 3500, date: "2023-04-15", description: "–î–∏–≤–∏–¥–µ–Ω–¥—ã –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª" }
                ]
            },
            {
                id: 5,
                name: "–í–æ–ª–∫–æ–≤ –°–µ—Ä–≥–µ–π",
                avatar: "–í–°",
                lastMessage: "–û—Ç–ø—Ä–∞–≤–∏–ª –∑–∞—è–≤–∫—É –Ω–∞ –≤—ã—Ö–æ–¥",
                lastTime: "–ß—Ç",
                operations: [
                    { id: 9, type: "–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥", amount: 0, date: "2023-05-11", description: "–ó–∞—è–≤–ª–µ–Ω–∏–µ –æ –≤—ã—Ö–æ–¥–µ –∏–∑ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞" },
                    { id: 10, type: "–í–æ–∑–≤—Ä–∞—Ç –ø–∞—è", amount: 15000, date: "2023-03-05", description: "–í–æ–∑–≤—Ä–∞—Ç —á–∞—Å—Ç–∏ –ø–∞—è" }
                ]
            }
        ];

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–∞–π—â–∏–∫
        let currentMember = null;
        let currentMessages = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            renderChats();
            setupEventListeners();
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞ –¥–∞–Ω–Ω—ã–µ –æ –ø–∞–π—â–∏–∫–∞—Ö
            setTimeout(function() {
                parent.postMessage({type: 'REQUEST_MEMBER_DATA'}, '*');
            }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã iframe –±—ã–ª –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            init();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞
        window.addEventListener('message', function(event) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —É—Ç–æ—á–Ω–∏—Ç–µ –¥–æ–º–µ–Ω)
            if (event.data && event.data.type === 'MEMBER_DATA') {
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–∞–π—â–∏–∫–æ–≤ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
                members = event.data.data;
                
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤
                renderChats();
                
                // –ï—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω –ø–∞–π—â–∏–∫, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
                if (currentMember) {
                    const updatedMember = members.find(m => m.id === currentMember.id);
                    if (updatedMember) {
                        currentMember = updatedMember;
                        renderMessages(updatedMember.operations);
                    }
                }
            }
        });

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const chatsList = document.getElementById('chatsList');
        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const currentName = document.getElementById('currentName');
        const currentAvatar = document.getElementById('currentAvatar');
        const sidebarRight = document.getElementById('sidebarRight');
        const detailsContent = document.getElementById('detailsContent');
        const operationType = document.getElementById('operationType');
        const operationAmount = document.getElementById('operationAmount');
        const operationDate = document.getElementById('operationDate');
        const operationDescription = document.getElementById('operationDescription');
        const editOperationBtn = document.getElementById('editOperationBtn');
        const menuBtn = document.getElementById('menuBtn');
        const sidebarLeft = document.getElementById('sidebarLeft');
        const searchInput = document.getElementById('searchInput');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            renderChats();
            setupEventListeners();
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
        function renderChats() {
            chatsList.innerHTML = '';
            
            members.forEach(member => {
                const chatItem = document.createElement('div');
                chatItem.className = 'chat-item';
                chatItem.dataset.id = member.id;
                
                chatItem.innerHTML = `
                    <div class="avatar">${member.avatar}</div>
                    <div class="chat-info">
                        <div class="chat-name">${member.name}</div>
                        <div class="last-message">${member.lastMessage}</div>
                    </div>
                    <div class="chat-time">${member.lastTime}</div>
                `;
                
                chatItem.addEventListener('click', () => selectMember(member));
                chatsList.appendChild(chatItem);
            });
        }

        // –í—ã–±–æ—Ä –ø–∞–π—â–∏–∫–∞
        function selectMember(member) {
            currentMember = member;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            currentName.textContent = member.name;
            currentAvatar.textContent = member.avatar;
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö —á–∞—Ç–æ–≤
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–º—É —á–∞—Ç—É
            document.querySelector(`.chat-item[data-id="${member.id}"]`).classList.add('active');
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–∞–π—â–∏–∫–∞
            renderMessages(member.operations);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∞–≤—É—é –ø–∞–Ω–µ–ª—å
            sidebarRight.classList.remove('visible');
        }

        // –†–µ–Ω–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
        function renderMessages(messages) {
            messagesContainer.innerHTML = '';
            currentMessages = [...messages];
            
            messages.forEach((msg, index) => {
                const messageElement = document.createElement('div');
                messageElement.className = 'message received';
                messageElement.dataset.id = msg.id;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—É–º–º—É
                const formattedAmount = msg.amount ? `${msg.amount.toLocaleString()} —Ä—É–±.` : '';
                
                messageElement.innerHTML = `
                    <div>${msg.type}: ${formattedAmount}</div>
                    <div class="message-time">${msg.date}</div>
                `;
                
                messageElement.addEventListener('click', () => showMessageDetails(msg));
                messagesContainer.appendChild(messageElement);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessageDetails(operation) {
            operationType.textContent = operation.type;
            operationAmount.textContent = operation.amount ? `${operation.amount.toLocaleString()} —Ä—É–±.` : '‚Äî';
            operationDate.textContent = operation.date;
            operationDescription.textContent = operation.description;
            
            sidebarRight.classList.add('visible');
        }

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text || !currentMember) return;
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const newMessage = {
                id: Date.now(),
                type: "–°–æ–æ–±—â–µ–Ω–∏–µ",
                amount: 0,
                date: new Date().toISOString().split('T')[0],
                description: text
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–ø–µ—Ä–∞—Ü–∏—è–º —Ç–µ–∫—É—â–µ–≥–æ –ø–∞–π—â–∏–∫–∞
            currentMember.operations.push(newMessage);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
            const messageElement = document.createElement('div');
            messageElement.className = 'message sent';
            messageElement.dataset.id = newMessage.id;
            
            messageElement.innerHTML = `
                <div>${text}</div>
                <div class="message-time">${formatTime(new Date())}</div>
            `;
            
            messageElement.addEventListener('click', () => showMessageDetails(newMessage));
            messagesContainer.appendChild(messageElement);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            messageInput.value = '';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
            updateLastMessage(currentMember.id, text);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è
        function formatTime(date) {
            return date.getHours() + ':' + (date.getMinutes() < 10 ? '0' : '') + date.getMinutes();
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ —á–∞—Ç–æ–≤
        function updateLastMessage(memberId, message) {
            const chatItem = document.querySelector(`.chat-item[data-id="${memberId}"]`);
            if (chatItem) {
                const lastMessageEl = chatItem.querySelector('.last-message');
                lastMessageEl.textContent = message.length > 30 ? message.substring(0, 30) + '...' : message;
                
                const timeEl = chatItem.querySelector('.chat-time');
                timeEl.textContent = formatTime(new Date());
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            sendButton.addEventListener('click', sendMessage);

            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            editOperationBtn.addEventListener('click', () => {
                alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏');
            });

            menuBtn.addEventListener('click', () => {
                sidebarLeft.classList.toggle('hidden');
            });

            // –ü–æ–∏—Å–∫
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const chatItems = document.querySelectorAll('.chat-item');

                chatItems.forEach(item => {
                    const name = item.querySelector('.chat-name').textContent.toLowerCase();
                    const isVisible = name.includes(searchTerm);
                    item.style.display = isVisible ? 'flex' : 'none';
                });
            });
        }

        // ============================================
        // –Ø–ù–î–ï–ö–°.–î–ò–°–ö –§–£–ù–ö–¶–ò–ò
        // ============================================

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫—É
        function handleYandexDiskClick() {
            // –¢–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫ –¥–ª—è Telegram
            if (window.TelegramMiniApp) {
                window.TelegramMiniApp.hapticFeedback('light');
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const token = localStorage.getItem('yandexDiskToken');
            const disabled = localStorage.getItem('yandexDiskDisabled') === 'true';

            if (disabled || !token) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                showYandexDiskModal();
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                showYandexDiskMenu();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è Telegram
        window.showYandexDiskAuthHelp = function(authUrl) {
            const content = `
                <div style="padding:30px;max-width:500px;margin:0 auto">
                    <div style="font-size:64px;text-align:center;margin-bottom:20px">üì±</div>
                    <h2 style="text-align:center;margin-bottom:15px;font-size:20px;font-weight:600">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h2>
                    
                    <div style="background:#f5f7fa;border-radius:12px;padding:20px;margin-bottom:20px">
                        <p style="margin:0 0 15px;font-size:14px;line-height:1.5">
                            <strong>–®–∞–≥ 1:</strong> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ
                        </p>
                        <p style="margin:0 0 15px;font-size:14px;line-height:1.5">
                            <strong>–®–∞–≥ 2:</strong> –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫—É
                        </p>
                        <p style="margin:0;font-size:14px;line-height:1.5">
                            <strong>–®–∞–≥ 3:</strong> –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Telegram –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞
                        </p>
                    </div>
                    
                    <div style="display:flex;flex-direction:column;gap:10px">
                        <a href="${authUrl}" target="_blank" rel="noopener noreferrer" 
                           style="min-height:44px;padding:12px;background:#0088cc;color:#fff;text-decoration:none;border-radius:12px;text-align:center;font-size:15px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:10px">
                            <span>üîê</span>
                            –û—Ç–∫—Ä—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
                        </a>
                        <button onclick="closeModal()" style="min-height:44px;padding:12px;background:#f5f7fa;color:#333;border:none;border-radius:12px;cursor:pointer;font-size:15px">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                    
                    <p style="text-align:center;font-size:12px;color:#999;margin-top:15px">
                        –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã –±—É–¥–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞—Ç–Ω–æ
                    </p>
                </div>
            `;
            showModal(content);
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function showYandexDiskModal() {
            const content = `
                <div style="padding:40px;text-align:center;max-width:500px;margin:0 auto">
                    <div style="font-size:64px;margin-bottom:20px">‚òÅÔ∏è</div>
                    <h2 style="margin-bottom:10px;font-size:22px;font-weight:600">–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫</h2>
                    <p style="color:#666;margin-bottom:30px;line-height:1.5">
                        –î–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫—É.
                        –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –ø–∞–ø–∫—É "–ö–û–û–ü–ï–†–ê–ù–¢".
                    </p>
                    <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:20px">
                        <button onclick="connectYandexDiskFromMessenger()"
                                style="min-height:44px;padding:12px 24px;background:#fc0;color:#000;border:none;border-radius:12px;cursor:pointer;font-size:15px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:10px">
                            <span style="font-size:20px">‚òÅÔ∏è</span>
                            –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å
                        </button>
                        <button onclick="useLocalStorageFromMessenger()"
                                style="min-height:44px;padding:12px 24px;background:#f5f7fa;color:#333;border:none;border-radius:12px;cursor:pointer;font-size:15px">
                            –†–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞
                        </button>
                    </div>
                    <p style="font-size:12px;color:#999;margin-top:20px">
                        üîí –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                    </p>
                </div>
            `;
            showModal(content);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function showYandexDiskMenu() {
            const status = getYandexDiskStatus();
            const lastSync = status.lastSync ? status.lastSync.toLocaleString() : '–ù–∏–∫–æ–≥–¥–∞';

            const content = `
                <div style="padding:30px;max-width:500px;margin:0 auto">
                    <div style="display:flex;align-items:center;gap:15px;margin-bottom:25px">
                        <div style="font-size:48px">‚òÅÔ∏è</div>
                        <div>
                            <h2 style="margin:0;font-size:20px;font-weight:600">–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫</h2>
                            <p style="margin:5px 0 0;color:#666;font-size:14px">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</p>
                        </div>
                    </div>

                    <div style="background:#f5f7fa;border-radius:12px;padding:20px;margin-bottom:20px">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
                            <span style="font-size:14px;color:#666">–°—Ç–∞—Ç—É—Å</span>
                            <span style="display:flex;align-items:center;gap:8px">
                                <span class="yandex-indicator" style="width:10px;height:10px;display:inline-block"></span>
                                <span style="font-weight:600;color:#4caf50">–ü–æ–¥–∫–ª—é—á—ë–Ω</span>
                            </span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
                            <span style="font-size:14px;color:#666">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</span>
                            <span style="font-size:14px;font-weight:500">${lastSync}</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <span style="font-size:14px;color:#666">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                            <span style="font-size:14px;font-weight:500;color:#4caf50">–í–∫–ª—é—á–µ–Ω–æ (30 —Å–µ–∫)</span>
                        </div>
                    </div>

                    <div style="display:flex;flex-direction:column;gap:10px">
                        <button onclick="forceSyncFromMessenger()" style="min-height:44px;padding:12px;background:#0088cc;color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:15px;font-weight:600">
                            üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å
                        </button>
                        <button onclick="createBackupFromMessenger()" style="min-height:44px;padding:12px;background:#4caf50;color:#fff;border:none;border-radius:12px;cursor:pointer;font-size:15px;font-weight:600">
                            üíæ –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                        </button>
                        <button onclick="logoutYandexFromMessenger()" style="min-height:44px;padding:12px;background:#ffebee;color:#c62828;border:none;border-radius:12px;cursor:pointer;font-size:15px">
                            üö™ –í—ã–π—Ç–∏ –∏–∑ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–∞
                        </button>
                        <button onclick="closeModal()" style="min-height:44px;padding:12px;background:#f5f7fa;color:#333;border:none;border-radius:12px;cursor:pointer;font-size:15px">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            showModal(content);
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞
        function getYandexDiskStatus() {
            const token = localStorage.getItem('yandexDiskToken');
            const folderId = localStorage.getItem('yandexCooperativFolderId');
            const disabled = localStorage.getItem('yandexDiskDisabled') === 'true';

            return {
                authorized: !!token && !!folderId,
                disabled: disabled,
                lastSync: null // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            };
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
        function updateYandexDiskIndicator() {
            const indicator = document.getElementById('yandexIndicator');
            const text = document.getElementById('yandexDiskText');

            if (!indicator || !text) return;

            const status = getYandexDiskStatus();

            if (status.disabled || !status.authorized) {
                indicator.className = 'yandex-indicator disconnected';
                text.textContent = '–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ (–æ—Ç–∫–ª—é—á—ë–Ω)';
            } else {
                indicator.className = 'yandex-indicator';
                text.textContent = '–Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫';
            }
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫—É
        async function connectYandexDiskFromMessenger() {
            if (typeof window.connectYandexDisk === 'function') {
                await window.connectYandexDisk();
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫—É –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ yandex-disk-integration.js');
            }
            closeModal();
        }

        // –†–∞–±–æ—Ç–∞ –±–µ–∑ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞
        function useLocalStorageFromMessenger() {
            localStorage.setItem('yandexDiskDisabled', 'true');
            updateYandexDiskIndicator();
            closeModal();

            if (typeof window.showToast === 'function') {
                window.showToast({
                    type: 'info',
                    message: '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ',
                    duration: 3000
                });
            }
        }

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        async function forceSyncFromMessenger() {
            if (typeof window.forceSyncYandex === 'function') {
                await window.forceSyncYandex();
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ yandex-disk-integration.js');
            }
            closeModal();
        }

        // –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
        async function createBackupFromMessenger() {
            if (typeof window.createBackupYandex === 'function') {
                await window.createBackupYandex();
            } else {
                alert('–§—É–Ω–∫—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ yandex-disk-integration.js');
            }
            closeModal();
        }

        // –í—ã—Ö–æ–¥ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞
        function logoutYandexFromMessenger() {
            if (typeof window.logoutYandexDisk === 'function') {
                window.logoutYandexDisk();
                updateYandexDiskIndicator();
            }
            closeModal();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function showModal(content) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const existingModal = document.querySelector('.yandex-modal-overlay');
            if (existingModal) {
                existingModal.remove();
            }

            const overlay = document.createElement('div');
            overlay.className = 'yandex-modal-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                animation: fadeIn 0.2s ease;
            `;

            const modal = document.createElement('div');
            modal.style.cssText = `
                background: #fff;
                border-radius: 16px;
                max-width: 90%;
                max-height: 90%;
                overflow-y: auto;
                animation: slideUp 0.3s ease;
            `;
            modal.innerHTML = content;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ overlay
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeModal();
                }
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
            window.currentModal = overlay;
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            if (window.currentModal) {
                window.currentModal.style.animation = 'fadeOut 0.2s ease';
                setTimeout(() => {
                    window.currentModal.remove();
                    window.currentModal = null;
                }, 200);
            }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            @keyframes slideUp {
                from { transform: translateY(20px); opacity: 0; }
                to { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            setTimeout(updateYandexDiskIndicator, 500);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ callback
            handleYandexCallback();
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ –Ø–Ω–¥–µ–∫—Å
        function handleYandexCallback() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ–∫–µ–Ω –≤ URL (–ø–æ—Å–ª–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞)
            const urlParams = new URLSearchParams(window.location.search);
            const hash = window.location.hash;
            
            let token = null;
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ hash
            if (hash && hash.includes('access_token')) {
                const hashParams = new URLSearchParams(hash.substring(1));
                token = hashParams.get('access_token');
            }
            
            // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ search
            if (!token && urlParams.get('access_token')) {
                token = urlParams.get('access_token');
            }
            
            if (token) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                localStorage.setItem('yandexDiskToken', token);
                
                // –û—á–∏—â–∞–µ–º URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                if (typeof window.showToast === 'function') {
                    window.showToast({
                        type: 'success',
                        message: '‚úì –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω!',
                        duration: 5000
                    });
                }
                
                // –¢–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫
                if (window.TelegramMiniApp) {
                    window.TelegramMiniApp.hapticFeedback('success');
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                setTimeout(() => {
                    if (typeof window.initYandexDiskIntegration === 'function') {
                        window.initYandexDiskIntegration();
                    }
                }, 1000);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç callback –æ–∫–Ω–∞
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'YANDEX_TOKEN') {
                    const token = event.data.token;
                    if (token) {
                        localStorage.setItem('yandexDiskToken', token);
                        
                        if (typeof window.showToast === 'function') {
                            window.showToast({
                                type: 'success',
                                message: '‚úì –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫ –ø–æ–¥–∫–ª—é—á—ë–Ω!',
                                duration: 5000
                            });
                        }
                        
                        if (window.TelegramMiniApp) {
                            window.TelegramMiniApp.hapticFeedback('success');
                        }
                        
                        setTimeout(() => {
                            if (typeof window.initYandexDiskIntegration === 'function') {
                                window.initYandexDiskIntegration();
                            }
                        }, 1000);
                    }
                }
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        // document.addEventListener('DOMContentLoaded', init); // –£–∂–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ window.load
    </script>
</body>
</html>