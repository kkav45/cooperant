<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini App ‚Äî –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</title>
    
    <!-- Telegram Web Apps SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –°—Ç–∏–ª–∏ Telegram Mini App -->
    <link rel="stylesheet" href="telegram-mini-app-styles.css">
    
    <style>
        body {
            padding: 20px;
            font-family: var(--tg-theme-font-family);
            background: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: var(--tg-theme-bg-color);
            border: 1px solid var(--tg-theme-border-color);
            border-radius: var(--tg-border-radius);
            padding: var(--tg-spacing-lg);
            margin-bottom: var(--tg-spacing-lg);
        }
        
        .test-section h2 {
            font-size: var(--tg-font-size-medium);
            margin-bottom: var(--tg-spacing-md);
            color: var(--tg-theme-text-color);
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--tg-spacing-md) 0;
            border-bottom: 1px solid var(--tg-theme-border-light);
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .test-label {
            font-size: var(--tg-font-size-normal);
            color: var(--tg-theme-text-color);
        }
        
        .test-value {
            font-size: var(--tg-font-size-small);
            color: var(--tg-theme-hint-color);
            font-family: monospace;
        }
        
        .test-value.success {
            color: var(--tg-theme-positive-color);
            font-weight: 600;
        }
        
        .test-value.error {
            color: var(--tg-theme-negative-color);
            font-weight: 600;
        }
        
        .test-button {
            min-width: var(--tg-touch-size);
            min-height: var(--tg-touch-size);
            padding: var(--tg-spacing-sm) var(--tg-spacing-lg);
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: var(--tg-border-radius);
            font-size: var(--tg-font-size-normal);
            font-family: var(--tg-theme-font-family);
            cursor: pointer;
            margin: var(--tg-spacing-xs);
        }
        
        .test-button:hover {
            opacity: 0.9;
        }
        
        .test-button:active {
            opacity: 0.8;
        }
        
        .color-sample {
            width: 40px;
            height: 40px;
            border-radius: var(--tg-border-radius-small);
            border: 1px solid var(--tg-theme-border-color);
            display: inline-block;
            vertical-align: middle;
            margin-right: var(--tg-spacing-sm);
        }
        
        .status-badge {
            padding: var(--tg-spacing-xs) var(--tg-spacing-sm);
            border-radius: var(--tg-border-radius-small);
            font-size: var(--tg-font-size-tiny);
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.passed {
            background: var(--tg-theme-status-active-bg);
            color: var(--tg-theme-status-active-text);
        }
        
        .status-badge.failed {
            background: var(--tg-theme-status-debt-bg);
            color: var(--tg-theme-status-debt-text);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 4px;
            overflow: hidden;
            margin: var(--tg-spacing-md) 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--tg-theme-button-color), var(--tg-theme-positive-color));
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; margin-bottom: 20px; font-size: var(--tg-font-size-title);">
            üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Telegram Mini App
        </h1>
        
        <!-- –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="test-section">
            <h2>üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
            <div class="test-item">
                <span class="test-label">Telegram WebApp SDK</span>
                <span class="test-value" id="sdkStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div class="test-item">
                <span class="test-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</span>
                <span class="test-value" id="platform">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–í–µ—Ä—Å–∏—è Telegram</span>
                <span class="test-value" id="version">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞</span>
                <span class="test-value" id="colorScheme">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–†–∞–∑–≤—ë—Ä–Ω—É—Ç–æ</span>
                <span class="test-value" id="isExpanded">‚Äî</span>
            </div>
        </div>
        
        <!-- ThemeParams -->
        <div class="test-section">
            <h2>üé® ThemeParams (—Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞)</h2>
            <div class="test-item">
                <span class="test-label">
                    <span class="color-sample" id="sampleBg"></span>
                    Background Color
                </span>
                <span class="test-value" id="bgColor">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">
                    <span class="color-sample" id="sampleText"></span>
                    Text Color
                </span>
                <span class="test-value" id="textColor">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">
                    <span class="color-sample" id="sampleButton"></span>
                    Button Color
                </span>
                <span class="test-value" id="buttonColor">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">Secondary Background</span>
                <span class="test-value" id="secondaryBg">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">Hint Color</span>
                <span class="test-value" id="hintColor">‚Äî</span>
            </div>
        </div>
        
        <!-- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="test-section">
            <h2>üë§ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div class="test-item">
                <span class="test-label">ID</span>
                <span class="test-value" id="userId">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–ò–º—è</span>
                <span class="test-value" id="firstName">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–§–∞–º–∏–ª–∏—è</span>
                <span class="test-value" id="lastName">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">Username</span>
                <span class="test-value" id="username">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">–Ø–∑—ã–∫</span>
                <span class="test-value" id="languageCode">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">Premium</span>
                <span class="test-value" id="isPremium">‚Äî</span>
            </div>
        </div>
        
        <!-- –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ -->
        <div class="test-section">
            <h2>‚úÖ –¢–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏</h2>
            
            <div class="test-item">
                <span class="test-label">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SDK</span>
                <span class="status-badge" id="testInit">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            
            <div class="test-item">
                <span class="test-label">–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ themeParams</span>
                <span class="status-badge" id="testTheme">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            
            <div class="test-item">
                <span class="test-label">Haptic Feedback</span>
                <span class="status-badge" id="testHaptic">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            
            <div class="test-item">
                <span class="test-label">MainButton</span>
                <span class="status-badge" id="testMainButton">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            
            <div class="test-item">
                <span class="test-label">BackButton</span>
                <span class="status-badge" id="testBackButton">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
            
            <div class="test-item">
                <span class="test-label">Viewport</span>
                <span class="status-badge" id="testViewport">–û–∂–∏–¥–∞–Ω–∏–µ</span>
            </div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç–æ–≤ -->
        <div class="test-section">
            <h2>üìà –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç–µ—Å—Ç–æ–≤</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div style="text-align: center; font-size: var(--tg-font-size-small); color: var(--tg-theme-hint-color);">
                <span id="passedTests">0</span> –∏–∑ <span id="totalTests">6</span> —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="test-section">
            <h2>üéÆ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            
            <div style="margin-bottom: var(--tg-spacing-md);">
                <strong style="display: block; margin-bottom: var(--tg-spacing-sm);">–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π –æ—Ç–∫–ª–∏–∫:</strong>
                <button class="test-button" onclick="testHaptic('light')">Light</button>
                <button class="test-button" onclick="testHaptic('medium')">Medium</button>
                <button class="test-button" onclick="testHaptic('heavy')">Heavy</button>
                <button class="test-button" onclick="testHaptic('success')">Success</button>
                <button class="test-button" onclick="testHaptic('warning')">Warning</button>
                <button class="test-button" onclick="testHaptic('error')">Error</button>
            </div>
            
            <div style="margin-bottom: var(--tg-spacing-md);">
                <strong style="display: block; margin-bottom: var(--tg-spacing-sm);">–î–∏–∞–ª–æ–≥–∏:</strong>
                <button class="test-button" onclick="testAlert()">Show Alert</button>
                <button class="test-button" onclick="testConfirm()">Show Confirm</button>
                <button class="test-button" onclick="testPopup()">Show Popup</button>
            </div>
            
            <div style="margin-bottom: var(--tg-spacing-md);">
                <strong style="display: block; margin-bottom: var(--tg-spacing-sm);">MainButton:</strong>
                <button class="test-button" onclick="testShowMainButton()">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                <button class="test-button" onclick="testHideMainButton()">–°–∫—Ä—ã—Ç—å</button>
            </div>
            
            <div style="margin-bottom: var(--tg-spacing-md);">
                <strong style="display: block; margin-bottom: var(--tg-spacing-sm);">BackButton:</strong>
                <button class="test-button" onclick="testShowBackButton()">–ü–æ–∫–∞–∑–∞—Ç—å</button>
                <button class="test-button" onclick="testHideBackButton()">–°–∫—Ä—ã—Ç—å</button>
            </div>
            
            <div>
                <strong style="display: block; margin-bottom: var(--tg-spacing-sm);">Viewport:</strong>
                <button class="test-button" onclick="testExpand()">Expand</button>
                <button class="test-button" onclick="testClose()">Close</button>
            </div>
        </div>
        
        <!-- CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -->
        <div class="test-section">
            <h2>üé® CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</h2>
            <div class="test-item">
                <span class="test-label">--tg-touch-size</span>
                <span class="test-value" id="cssTouchSize">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">--tg-font-size-normal</span>
                <span class="test-value" id="cssFontSize">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">--tg-border-radius</span>
                <span class="test-value" id="cssBorderRadius">‚Äî</span>
            </div>
            <div class="test-item">
                <span class="test-label">--tg-spacing-lg</span>
                <span class="test-value" id="cssSpacing">‚Äî</span>
            </div>
        </div>
    </div>
    
    <!-- Telegram Mini App Integration -->
    <script src="telegram-mini-app.js"></script>
    
    <script>
        let testsPassed = 0;
        const totalTests = 6;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            await runTests();
        });
        
        async function runTests() {
            // –¢–µ—Å—Ç 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            try {
                const isTelegram = await window.TelegramMiniApp.init();
                updateTestStatus('testInit', isTelegram ? 'passed' : 'warning', isTelegram ? '‚úì' : '‚ö†');
                if (isTelegram) testsPassed++;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                const tg = window.TelegramMiniApp.getTelegram();
                if (tg) {
                    document.getElementById('sdkStatus').textContent = '–ü–æ–¥–∫–ª—é—á—ë–Ω';
                    document.getElementById('sdkStatus').className = 'test-value success';
                    document.getElementById('platform').textContent = tg.platform || '‚Äî';
                    document.getElementById('version').textContent = tg.version || '‚Äî';
                    document.getElementById('colorScheme').textContent = tg.colorScheme || '‚Äî';
                    document.getElementById('isExpanded').textContent = tg.isExpanded ? '–î–∞' : '–ù–µ—Ç';
                } else {
                    document.getElementById('sdkStatus').textContent = '–†–µ–∂–∏–º —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏';
                    document.getElementById('sdkStatus').className = 'test-value warning';
                }
                
            } catch (e) {
                updateTestStatus('testInit', 'failed', '‚úó');
                document.getElementById('sdkStatus').textContent = '–û—à–∏–±–∫–∞: ' + e.message;
                document.getElementById('sdkStatus').className = 'test-value error';
            }
            
            // –¢–µ—Å—Ç 2: ThemeParams
            try {
                const themeParams = window.TelegramMiniApp.getThemeParams();
                if (themeParams && Object.keys(themeParams).length > 0) {
                    updateTestStatus('testTheme', 'passed', '‚úì');
                    testsPassed++;
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ü–≤–µ—Ç–∞
                    if (themeParams.bg_color) {
                        document.getElementById('bgColor').textContent = themeParams.bg_color;
                        document.getElementById('sampleBg').style.background = themeParams.bg_color;
                    }
                    if (themeParams.text_color) {
                        document.getElementById('textColor').textContent = themeParams.text_color;
                        document.getElementById('sampleText').style.background = themeParams.text_color;
                    }
                    if (themeParams.button_color) {
                        document.getElementById('buttonColor').textContent = themeParams.button_color;
                        document.getElementById('sampleButton').style.background = themeParams.button_color;
                    }
                    if (themeParams.secondary_bg_color) {
                        document.getElementById('secondaryBg').textContent = themeParams.secondary_bg_color;
                    }
                    if (themeParams.hint_color) {
                        document.getElementById('hintColor').textContent = themeParams.hint_color;
                    }
                } else {
                    updateTestStatus('testTheme', 'warning', '‚ö†');
                }
            } catch (e) {
                updateTestStatus('testTheme', 'failed', '‚úó');
            }
            
            // –¢–µ—Å—Ç 3: Haptic Feedback
            try {
                if (window.TelegramMiniApp.hapticFeedback) {
                    updateTestStatus('testHaptic', 'passed', '‚úì');
                    testsPassed++;
                } else {
                    updateTestStatus('testHaptic', 'failed', '‚úó');
                }
            } catch (e) {
                updateTestStatus('testHaptic', 'failed', '‚úó');
            }
            
            // –¢–µ—Å—Ç 4: MainButton
            try {
                const tg = window.TelegramMiniApp.getTelegram();
                if (tg && tg.MainButton) {
                    updateTestStatus('testMainButton', 'passed', '‚úì');
                    testsPassed++;
                } else {
                    updateTestStatus('testMainButton', 'warning', '‚ö†');
                }
            } catch (e) {
                updateTestStatus('testMainButton', 'failed', '‚úó');
            }
            
            // –¢–µ—Å—Ç 5: BackButton
            try {
                const tg = window.TelegramMiniApp.getTelegram();
                if (tg && tg.BackButton) {
                    updateTestStatus('testBackButton', 'passed', '‚úì');
                    testsPassed++;
                } else {
                    updateTestStatus('testBackButton', 'warning', '‚ö†');
                }
            } catch (e) {
                updateTestStatus('testBackButton', 'failed', '‚úó');
            }
            
            // –¢–µ—Å—Ç 6: Viewport
            try {
                const viewportHeight = window.TelegramMiniApp.viewportHeight;
                if (viewportHeight > 0) {
                    updateTestStatus('testViewport', 'passed', '‚úì');
                    testsPassed++;
                    document.getElementById('userId').textContent = viewportHeight + 'px';
                } else {
                    updateTestStatus('testViewport', 'warning', '‚ö†');
                }
            } catch (e) {
                updateTestStatus('testViewport', 'failed', '‚úó');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
            updateProgress();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            displayUserData();
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            displayCSSVariables();
        }
        
        function updateTestStatus(testId, status, text) {
            const element = document.getElementById(testId);
            element.textContent = text;
            element.className = 'status-badge ' + status;
        }
        
        function updateProgress() {
            const percentage = (testsPassed / totalTests) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('passedTests').textContent = testsPassed;
            document.getElementById('totalTests').textContent = totalTests;
        }
        
        function displayUserData() {
            const userData = window.TelegramMiniApp.getUserData();
            if (userData) {
                document.getElementById('userId').textContent = userData.id || '‚Äî';
                document.getElementById('firstName').textContent = userData.firstName || '‚Äî';
                document.getElementById('lastName').textContent = userData.lastName || '‚Äî';
                document.getElementById('username').textContent = userData.username || '‚Äî';
                document.getElementById('languageCode').textContent = userData.languageCode || '‚Äî';
                document.getElementById('isPremium').textContent = userData.isPremium ? '–î–∞ ‚úì' : '–ù–µ—Ç';
            }
        }
        
        function displayCSSVariables() {
            const root = getComputedStyle(document.documentElement);
            document.getElementById('cssTouchSize').textContent = root.getPropertyValue('--tg-touch-size').trim();
            document.getElementById('cssFontSize').textContent = root.getPropertyValue('--tg-font-size-normal').trim();
            document.getElementById('cssBorderRadius').textContent = root.getPropertyValue('--tg-border-radius').trim();
            document.getElementById('cssSpacing').textContent = root.getPropertyValue('--tg-spacing-lg').trim();
        }
        
        // –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        
        function testHaptic(type) {
            window.TelegramMiniApp.hapticFeedback(type);
        }
        
        function testAlert() {
            window.TelegramMiniApp.showAlert('–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!');
        }
        
        function testConfirm() {
            window.TelegramMiniApp.showConfirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã?', (result) => {
                console.log('Confirm result:', result);
            });
        }
        
        function testPopup() {
            window.TelegramMiniApp.showPopup({
                title: '–¢–µ—Å—Ç–æ–≤—ã–π Popup',
                message: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–æ–ø–∫—É:',
                buttons: [
                    {id: 'ok', type: 'default', text: 'OK'},
                    {id: 'cancel', type: 'destructive', text: '–û—Ç–º–µ–Ω–∞'}
                ]
            }, (buttonId) => {
                console.log('Popup result:', buttonId);
            });
        }
        
        function testShowMainButton() {
            window.TelegramMiniApp.showMainButton('–¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê');
            window.TelegramMiniApp.handleMainButtonClick = () => {
                window.TelegramMiniApp.hapticFeedback('success');
                window.TelegramMiniApp.hideMainButton();
            };
        }
        
        function testHideMainButton() {
            window.TelegramMiniApp.hideMainButton();
        }
        
        function testShowBackButton() {
            window.TelegramMiniApp.showBackButton();
            window.TelegramMiniApp.addBackHandler(() => {
                console.log('Back pressed');
                window.TelegramMiniApp.hideBackButton();
                window.TelegramMiniApp.removeBackHandler();
            });
        }
        
        function testHideBackButton() {
            window.TelegramMiniApp.hideBackButton();
            window.TelegramMiniApp.removeBackHandler();
        }
        
        function testExpand() {
            window.TelegramMiniApp.expand();
        }
        
        function testClose() {
            if (confirm('–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?')) {
                window.TelegramMiniApp.close();
            }
        }
    </script>
</body>
</html>
